general:
  branches:
    only:
      - develop # branches to build
      - /QA_.*/
  #artifacts:
    #- "~/simplecov"
machine:
  ruby:
    version: 2.0.0-p598
  java:
    version: openjdk7  
checkout:
  post:
    - git submodule add --force https://github.com/1-Page/Sourcing-FrontEnd-Automation-Scripts Sourcing-FrontEnd-Automation-Scripts
    - git submodule update --init # use submodules
    - git submodule foreach git pull origin master
    
dependencies:
  pre:
    #- bundle install && cd sourcing-test-framework && gem install --local taza-0.9.2.1.gem #install all gems & local gem
    #- cd sourcing-test-framework && bundle update # update for all the gems not included in Gemfile
    - sudo apt-add-repository -y ppa:yandex-qatools/allure-framework #reports 
    - sudo apt-get update #reports
    - sudo apt-get install allure-cli #reports 
    #- cd sourcing-test-framework && gem update allure-rspec && gem update rspec # update gems to make it 'just work' 
    - bundler install
    - cd Sourcing-FrontEnd-Automation-Scripts && gem install --local taza-0.9.2.1.gem
    #- cd ..
    #- npm install -g gulp
    #- cd src && npm install
    #- cd sourcing-frontend/src && npm install gulp --save-dev
    #- npm link gulp
    #- update bundler


    #- gem install bundler
    #- gem install rspec
    #- bundle exec rspec --color 
    #- bundle exec rake spec  
    #- gem install --git => 'https://github.com/Rodion13/taza'
    
  #override:
   # - bundle install: # note ':' here
    # #   timeout: 180 # fail if command has no output for 3 minutes
## Customize test commands
test:
  override:
    - 'cd Sourcing-FrontEnd-Automation-Scripts && rspec spec/isolation/search_page_spec.rb' #run spec
    #- 'cd src && gulp test-frb'
    #- 'cd src && gulp test-branchout'
    #- 'cd src && gulp test-1-page'
    #- 'cd src && gradle check jacocoTestReport'

  post:
    - mkdir -p Sourcing-FrontEnd-Automation-Scripts/reports/allure
    - allure generate Sourcing-FrontEnd-Automation-Scripts/reports/allure -o $CIRCLE_TEST_REPORTS/Sourcing-FrontEnd-Automation-Scripts/allure -v 1.4.3  
    #- cp -R build/reports/* $CIRCLE_ARTIFACTS
